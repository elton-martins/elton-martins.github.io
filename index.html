<html>
    <head>
        <title></title>
    </head>
    <body>
        CEPs de:
        <input type="text" id="ceps_de" value="0000000" />
        At√©: <input type="text" id="ceps_ate" value="0000000" />

        <button type="button" onClick="busca()">Buscar</button><br />
        <button type="button" onClick="geraCSV()">Gerar CSV</button><br />

        <table id="tbl-municipios">
            <thead>
                <tr>
                    <th>CEP</th>
                    <th>Logradouro</th>
                    <th>Complemento</th>
                    <th>Bairro</th>
                    <th>Localidade</th>
                    <th>UF</th>
                    <th>IBGE</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </body>
    <script language="javascript">
        let csv = "Nome;UF;IBGE\n";
        function geraCSV() {
            const blob = new Blob([csv], { type: "text/csv;charset=iso-8859-1" });
            const objUrl = URL.createObjectURL(blob);

            const link = document.createElement("a");
            link.setAttribute("href", objUrl);
            link.setAttribute("download", "File.csv");
            link.textContent = "Click to Download";

            document.querySelector("body").append(link);
        }

        function busca() {
            for (i = document.getElementById("ceps_de").value; i <= document.getElementById("ceps_ate").value; i++) {
                const cep = String(i);
                buscaCEP(cep.padStart(9 - cep.length, "0"));
            }
        }
        async function buscaCEP(cep) {
            console.log("Buscando CEP", cep);
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            console.log(response);
            const jsoncep = await response.json();

            console.log(cep);
        }

        /*function criaLinha(municipio, uf) {
            const table = document.getElementById("tbl-municipios");
            const tr = table.insertRow();
            csv += municipio.nome + ";" + uf + ";" + municipio.id + "\n";
            tr.insertCell().appendChild(document.createTextNode(municipio.nome + ";" + uf + ";" + municipio.id));
            tr.insertCell().appendChild(document.createTextNode(uf));
            tr.insertCell().appendChild(document.createTextNode(municipio.id));
        }*/
    </script>
</html>
